<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=author content><meta name=description content="A simple example of a non-blocking client-server relationship in ZeroMQ using a client which pushes and a server which pulls."><link rel=icon href=https://hightower.space/img/favicon.png><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin=anonymous referrerpolicy=no-referrer><meta name=keywords content=" hugo  latex  theme "><meta property="og:title" content="Simple, Non-blocking, Push/Pull Example with ZeroMQ"><meta property="og:description" content="A simple example of a non-blocking client-server relationship in ZeroMQ using a client which pushes and a server which pulls."><meta property="og:type" content="article"><meta property="og:url" content="https://hightower.space/posts/zeromq-push-pull/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-26T00:00:00+00:00"><meta property="article:modified_time" content="2019-02-26T00:00:00+00:00"><link rel=canonical href=https://hightower.space/posts/zeromq-push-pull/><meta itemprop=name content="Simple, Non-blocking, Push/Pull Example with ZeroMQ"><meta itemprop=description content="A simple example of a non-blocking client-server relationship in ZeroMQ using a client which pushes and a server which pulls."><meta itemprop=datePublished content="2019-02-26T00:00:00+00:00"><meta itemprop=dateModified content="2019-02-26T00:00:00+00:00"><meta itemprop=wordCount content="395"><meta itemprop=keywords content="ZeroMQ,Messaging Queues,Programming,Push & Pull,Client & Server,Non-blocking,Python,TotalEmail,"><link media=screen rel=stylesheet href=https://hightower.space/css/common.css><link media=screen rel=stylesheet href=https://hightower.space/css/content.css><title>Simple, Non-blocking, Push/Pull Example with ZeroMQ - Floyd</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Simple, Non-blocking, Push/Pull Example with ZeroMQ"><meta name=twitter:description content="A simple example of a non-blocking client-server relationship in ZeroMQ using a client which pushes and a server which pulls."><link rel=stylesheet href=https://hightower.space/css/single.css></head><body><div id=wrapper><header id=header><h1><a href=https://hightower.space/>Floyd</a></h1><p class=description>A digital space for sharing my thoughts.</p><br><nav><span class=nav-bar-item><a class=link href=/categories/reading-list>Reading Lists</a></span>
<span class=nav-bar-item><a class=link href=/tags>Tags</a></span>
<span class=nav-bar-item><a class=link href=/skills>Skills</a></span>
<span class=nav-bar-item><a class=link href=/posts>All Posts</a></span>
<span class=nav-bar-item><a class=link href=/about>About</a></span></nav></header><main id=main class=post><div class=warning>⚠️ It has been <i>1270</i> days since the last update, the content of the article may be outdated.</div><h1>Simple, Non-blocking, Push/Pull Example with ZeroMQ</h1><div><a class=link href=https://hightower.space/tags/zeromq>#ZeroMQ</a>
<a class=link href=https://hightower.space/tags/messaging-queues>#Messaging Queues</a>
<a class=link href=https://hightower.space/tags/programming>#Programming</a>
<a class=link href=https://hightower.space/tags/push-pull>#Push & Pull</a>
<a class=link href=https://hightower.space/tags/client-server>#Client & Server</a>
<a class=link href=https://hightower.space/tags/non-blocking>#Non-blocking</a>
<a class=link href=https://hightower.space/tags/python>#Python</a>
<a class=link href=https://hightower.space/tags/totalemail>#TotalEmail</a></div><article class=content><h3 id=intro>Intro</h3><p>While working on <a href=https://totalemail.io>TotalEmail</a>, I ran across a situation in which we needed to make a non-blocking request (a request where the client makes the request without waiting or expecting a response). To accomplish this, I started looking into <a href=http://zeromq.org/>ZeroMQ</a>. ZeroMQ is amazing! It is very well-structured and generalizes the problem of messaging between machines very effectively.</p><p>While the <a href=http://zeromq.org/>ZeroMQ</a> <a href=http://zguide.zeromq.org/page:all>documentation</a> is extensive, it is easy (at least for me) to get lost in the docs and forget the simplicity and elegance of ZeroMQ. In this post, I share a simple, non-blocking, push/pull system that pushes from a client (without waiting for a response) and pulls the data into a server. The benefit of this construct is that the client does not wait for a response from the server. In this sense, it is a non-blocking operation.</p><h3 id=the-code>The Code</h3><h4 id=client>Client</h4><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#5bc4bf>import</span> <span style=color:#fec418>zmq</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>context <span style=color:#5bc4bf>=</span> zmq<span style=color:#5bc4bf>.</span>Context()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71># Socket to send messages on</span>
</span></span><span style=display:flex><span>sender <span style=color:#5bc4bf>=</span> context<span style=color:#5bc4bf>.</span>socket(zmq<span style=color:#5bc4bf>.</span>PUSH)
</span></span><span style=display:flex><span>sender<span style=color:#5bc4bf>.</span>bind(<span style=color:#48b685>&#34;tcp://*:5559&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#815ba4>for</span> i <span style=color:#5bc4bf>in</span> range(<span style=color:#f99b15>3</span>):
</span></span><span style=display:flex><span>    print(<span style=color:#48b685>&#39;sending </span><span style=color:#f99b15>{}</span><span style=color:#48b685>&#39;</span><span style=color:#5bc4bf>.</span>format(i))
</span></span><span style=display:flex><span>    sender<span style=color:#5bc4bf>.</span>send_string(str(i))
</span></span></code></pre></div><p>The client binds to a port (<code>5559</code> - this port is used in the server code as well) and then sends the numbers zero, one, and two to the server. The client pushes data (as specified by the <code>zmq.PUSH</code>) which means that it does not wait for a response from the server.</p><h4 id=server>Server</h4><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#5bc4bf>import</span> <span style=color:#fec418>time</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>import</span> <span style=color:#fec418>zmq</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>context <span style=color:#5bc4bf>=</span> zmq<span style=color:#5bc4bf>.</span>Context()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71># Socket to receive messages on</span>
</span></span><span style=display:flex><span>receiver <span style=color:#5bc4bf>=</span> context<span style=color:#5bc4bf>.</span>socket(zmq<span style=color:#5bc4bf>.</span>PULL)
</span></span><span style=display:flex><span>receiver<span style=color:#5bc4bf>.</span>connect(<span style=color:#48b685>&#34;tcp://localhost:5559&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#815ba4>def</span> <span style=color:#06b6ef>print_value</span>(s):
</span></span><span style=display:flex><span>    time<span style=color:#5bc4bf>.</span>sleep(<span style=color:#f99b15>2</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#48b685>&#39;value: </span><span style=color:#f99b15>{}</span><span style=color:#48b685>&#39;</span><span style=color:#5bc4bf>.</span>format(s))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71># Process tasks forever</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>while</span> <span style=color:#815ba4>True</span>:
</span></span><span style=display:flex><span>    s <span style=color:#5bc4bf>=</span> receiver<span style=color:#5bc4bf>.</span>recv_string()
</span></span><span style=display:flex><span>    print(<span style=color:#48b685>&#39;received </span><span style=color:#f99b15>{}</span><span style=color:#48b685>&#39;</span><span style=color:#5bc4bf>.</span>format(s))
</span></span><span style=display:flex><span>    print_value(s)
</span></span></code></pre></div><p>The server is designed to pull content (as specified by the <code>zmq.PULL</code>) from <code>tcp://localhost:5559</code>. When it receives something, it will send it to the <code>print_value</code> function where the value will be printed off after two seconds. Again, the nice thing about this setup is that, even though the server takes some time to process the incoming data, the client doesn&rsquo;t have to wait around for a response from the server.</p><h3 id=benefits>Benefits</h3><p>This construct is helpful because it:</p><ul><li>Keeps the communication between systems as simple as possible<ul><li>No worrying about http status codes, query parameters, or request bodies</li></ul></li><li>Is non-blocking in the sense that the client doesn&rsquo;t wait for a response from the server</li><li>Is simple (in terms of the code required to accomplish the task)</li></ul><p>If you have never used ZeroMQ, give it a try! It is fun to use and opens some exciting doors.</p></article><div class=paginator><a class=link href=https://hightower.space/posts/math-behind-domain-squatting/>← prev</a>
<a class=link href=https://hightower.space/posts/2020-reading-list/>next →</a></div><div class=comment></div></main><footer id=footer><div><span>© 2019</span> - <span>2022</span></div><div><span>Powered by</span>
<a class=link href=https://gohugo.io/>Hugo</a>
<span>| Theme</span>
<a class=link href=https://github.com/fhightower/hugo-theme-texify>TeXify</a></div><div class=footnote><span><a class=link href=https://github.com/fhightower>GitHub</a> |
<a class=link href="https://500px.com/p/fhightower?view=photos">500px</a> |
<a class=link href=mailto:floyd.hightower27@gmail.com>Email</a> |
<a class=link href=/index.xml>RSS</a></span></div></footer></div></body></html>