<!doctype html><html lang=en><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Simple, Non-blocking, Push/Pull Example with ZeroMQ | Floyd Hightower</title><link rel=canonical href=https://hightower.space/posts/zeromq-push-pull/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Simple, Non-blocking, Push/Pull Example with ZeroMQ"><meta property="og:description" content="A simple example of a non-blocking client-server relationship in ZeroMQ using a client which pushes and a server which pulls."><meta property="og:type" content="article"><meta property="og:url" content="https://hightower.space/posts/zeromq-push-pull/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-26T00:00:00+00:00"><meta property="article:modified_time" content="2019-02-26T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Simple, Non-blocking, Push/Pull Example with ZeroMQ"><meta name=twitter:description content="A simple example of a non-blocking client-server relationship in ZeroMQ using a client which pushes and a server which pulls."><link rel=stylesheet href=https://hightower.space/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://hightower.space/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li><li><a href=/skills>Skills</a></li><li><a href=/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://hightower.space/posts/math-behind-domain-squatting/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://hightower.space/posts/2020-reading-list/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="mailto:?subject=Simple%2c%20Non-blocking%2c%20Push%2fPull%20Example%20with%20ZeroMQ&body=Check out this article: https%3a%2f%2fhightower.space%2fposts%2fzeromq-push-pull%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fhightower.space%2fposts%2fzeromq-push-pull%2f&title=Simple%2c%20Non-blocking%2c%20Push%2fPull%20Example%20with%20ZeroMQ" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fhightower.space%2fposts%2fzeromq-push-pull%2f&t=Simple%2c%20Non-blocking%2c%20Push%2fPull%20Example%20with%20ZeroMQ" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#intro>Intro</a></li><li><a href=#the-code>The Code</a><ul><li><a href=#client>Client</a></li><li><a href=#server>Server</a></li></ul></li><li><a href=#benefits>Benefits</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Simple, Non-blocking, Push/Pull Example with ZeroMQ</h1><div class=meta><div class=postdate><time datetime="2019-02-26 00:00:00 +0000 UTC" itemprop=datePublished>2019-02-26</time></div><div class=article-read-time><i class="far fa-clock"></i>
2 minute read</div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/zeromq rel=tag>ZeroMQ</a>
,
<a class=tag-link href=/tags/messaging-queues rel=tag>Messaging Queues</a>
,
<a class=tag-link href=/tags/programming rel=tag>Programming</a>
,
<a class=tag-link href=/tags/push-pull rel=tag>Push & Pull</a>
,
<a class=tag-link href=/tags/client-server rel=tag>Client & Server</a>
,
<a class=tag-link href=/tags/non-blocking rel=tag>Non-blocking</a>
,
<a class=tag-link href=/tags/python rel=tag>Python</a>
,
<a class=tag-link href=/tags/totalemail rel=tag>TotalEmail</a></div></div></header><div class=content itemprop=articleBody><h3 id=intro>Intro</h3><p>While working on <a href=https://totalemail.io>TotalEmail</a>, I ran across a situation in which we needed to make a non-blocking request (a request where the client makes the request without waiting or expecting a response). To accomplish this, I started looking into <a href=http://zeromq.org/>ZeroMQ</a>. ZeroMQ is amazing! It is very well-structured and generalizes the problem of messaging between machines very effectively.</p><p>While the <a href=http://zeromq.org/>ZeroMQ</a> <a href=http://zguide.zeromq.org/page:all>documentation</a> is extensive, it is easy (at least for me) to get lost in the docs and forget the simplicity and elegance of ZeroMQ. In this post, I share a simple, non-blocking, push/pull system that pushes from a client (without waiting for a response) and pulls the data into a server. The benefit of this construct is that the client does not wait for a response from the server. In this sense, it is a non-blocking operation.</p><h3 id=the-code>The Code</h3><h4 id=client>Client</h4><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#5bc4bf>import</span> <span style=color:#fec418>zmq</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>context <span style=color:#5bc4bf>=</span> zmq<span style=color:#5bc4bf>.</span>Context()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71># Socket to send messages on</span>
</span></span><span style=display:flex><span>sender <span style=color:#5bc4bf>=</span> context<span style=color:#5bc4bf>.</span>socket(zmq<span style=color:#5bc4bf>.</span>PUSH)
</span></span><span style=display:flex><span>sender<span style=color:#5bc4bf>.</span>bind(<span style=color:#48b685>&#34;tcp://*:5559&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#815ba4>for</span> i <span style=color:#5bc4bf>in</span> range(<span style=color:#f99b15>3</span>):
</span></span><span style=display:flex><span>    print(<span style=color:#48b685>&#39;sending </span><span style=color:#f99b15>{}</span><span style=color:#48b685>&#39;</span><span style=color:#5bc4bf>.</span>format(i))
</span></span><span style=display:flex><span>    sender<span style=color:#5bc4bf>.</span>send_string(str(i))
</span></span></code></pre></div><p>The client binds to a port (<code>5559</code> - this port is used in the server code as well) and then sends the numbers zero, one, and two to the server. The client pushes data (as specified by the <code>zmq.PUSH</code>) which means that it does not wait for a response from the server.</p><h4 id=server>Server</h4><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#5bc4bf>import</span> <span style=color:#fec418>time</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>import</span> <span style=color:#fec418>zmq</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>context <span style=color:#5bc4bf>=</span> zmq<span style=color:#5bc4bf>.</span>Context()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71># Socket to receive messages on</span>
</span></span><span style=display:flex><span>receiver <span style=color:#5bc4bf>=</span> context<span style=color:#5bc4bf>.</span>socket(zmq<span style=color:#5bc4bf>.</span>PULL)
</span></span><span style=display:flex><span>receiver<span style=color:#5bc4bf>.</span>connect(<span style=color:#48b685>&#34;tcp://localhost:5559&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#815ba4>def</span> <span style=color:#06b6ef>print_value</span>(s):
</span></span><span style=display:flex><span>    time<span style=color:#5bc4bf>.</span>sleep(<span style=color:#f99b15>2</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#48b685>&#39;value: </span><span style=color:#f99b15>{}</span><span style=color:#48b685>&#39;</span><span style=color:#5bc4bf>.</span>format(s))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71># Process tasks forever</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>while</span> <span style=color:#815ba4>True</span>:
</span></span><span style=display:flex><span>    s <span style=color:#5bc4bf>=</span> receiver<span style=color:#5bc4bf>.</span>recv_string()
</span></span><span style=display:flex><span>    print(<span style=color:#48b685>&#39;received </span><span style=color:#f99b15>{}</span><span style=color:#48b685>&#39;</span><span style=color:#5bc4bf>.</span>format(s))
</span></span><span style=display:flex><span>    print_value(s)
</span></span></code></pre></div><p>The server is designed to pull content (as specified by the <code>zmq.PULL</code>) from <code>tcp://localhost:5559</code>. When it receives something, it will send it to the <code>print_value</code> function where the value will be printed off after two seconds. Again, the nice thing about this setup is that, even though the server takes some time to process the incoming data, the client doesn&rsquo;t have to wait around for a response from the server.</p><h3 id=benefits>Benefits</h3><p>This construct is helpful because it:</p><ul><li>Keeps the communication between systems as simple as possible<ul><li>No worrying about http status codes, query parameters, or request bodies</li></ul></li><li>Is non-blocking in the sense that the client doesn&rsquo;t wait for a response from the server</li><li>Is simple (in terms of the code required to accomplish the task)</li></ul><p>If you have never used ZeroMQ, give it a try! It is fun to use and opens some exciting doors.</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li><li><a href=/skills>Skills</a></li><li><a href=/about>About</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><ul><li><a href=#intro>Intro</a></li><li><a href=#the-code>The Code</a><ul><li><a href=#client>Client</a></li><li><a href=#server>Server</a></li></ul></li><li><a href=#benefits>Benefits</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="mailto:?subject=Simple%2c%20Non-blocking%2c%20Push%2fPull%20Example%20with%20ZeroMQ&body=Check out this article: https%3a%2f%2fhightower.space%2fposts%2fzeromq-push-pull%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fhightower.space%2fposts%2fzeromq-push-pull%2f&title=Simple%2c%20Non-blocking%2c%20Push%2fPull%20Example%20with%20ZeroMQ" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fhightower.space%2fposts%2fzeromq-push-pull%2f&t=Simple%2c%20Non-blocking%2c%20Push%2fPull%20Example%20with%20ZeroMQ" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2022 Floyd Hightower</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li><li><a href=/skills>Skills</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>